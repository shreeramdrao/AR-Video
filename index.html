<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AR Video</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands"></script>
    <script src="https://cdn.jsdelivr.net/npm/@webxr-polyfill/webxr-polyfill.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three/examples/jsm/libs/motion-controllers.module.js"></script>
</head>
<body style="margin: 0; overflow: hidden;">

    <!-- Start AR Button -->
    <button id="startAR" style="
        position: absolute; 
        top: 50%; 
        left: 50%; 
        transform: translate(-50%, -50%);
        padding: 15px 25px; 
        font-size: 18px; 
        background: #007bff; 
        color: white; 
        border: none; 
        border-radius: 8px; 
        cursor: pointer;
        z-index: 10;">
        Start AR Video
    </button>

    <script>
        let scene, camera, renderer, xrSession, videoTexture;

        async function startAR() {
            if (navigator.xr) {
                try {
                    // Request WebXR AR session
                    xrSession = await navigator.xr.requestSession('immersive-ar', {
                        requiredFeatures: ['hit-test']
                    });

                    // Initialize THREE.js scene
                    setupScene();

                    // Set WebXR session
                    renderer.xr.setSession(xrSession);

                } catch (err) {
                    console.error('WebXR session failed', err);
                }
            } else {
                console.warn('WebXR not supported');
            }
        }

        function setupScene() {
            scene = new THREE.Scene();

            // Setup camera
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            scene.add(camera);

            // Setup WebGL renderer
            renderer = new THREE.WebGLRenderer({ alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.xr.enabled = true;
            document.body.appendChild(renderer.domElement);

            // Add light
            const light = new THREE.HemisphereLight(0xffffff, 0xbbbbff, 1);
            scene.add(light);

            // Load video texture
            const video = document.createElement('video');
            video.src = 'https://ar-video.vercel.app/assets/4817-180570037_small.mp4'; // Update with your video link
            video.loop = true;
            video.muted = false;
            video.play();  // Auto-play

            videoTexture = new THREE.VideoTexture(video);
            videoTexture.minFilter = THREE.LinearFilter;
            videoTexture.magFilter = THREE.LinearFilter;
            videoTexture.format = THREE.RGBAFormat;

            // Create video screen in AR
            const geometry = new THREE.PlaneGeometry(1.5, 1); // Adjust screen size
            const material = new THREE.MeshBasicMaterial({ map: videoTexture });
            const videoScreen = new THREE.Mesh(geometry, material);
            videoScreen.position.set(0, 1, -2); // Adjust position in AR space
            scene.add(videoScreen);

            // Render loop
            function animate() {
                renderer.setAnimationLoop(() => {
                    renderer.render(scene, camera);
                });
            }
            animate();
        }

        // Button Click Event to Start AR
        document.getElementById('startAR').addEventListener('click', function() {
            this.style.display = 'none'; // Hide button after click
            startAR();
        });

    </script>
</body>
</html>
